<?php

    $vhostList =
        "ServerName www.yakima.net
        ServerName sb3.yakima.net
        ServerName kozmo.yakima.net
        #       ServerName localhost
        ServerName sitedown.yakima.net
        ServerName rainloop.yakima.net
        ServerName woo.yakima.net
        #       ServerName new.yakima.net
        ServerName agmweeklydev.yakima.net
        ServerName dev.ag-mg-timesheets.com
        ServerName ag-mg-timesheets.com
        ServerName sbframework.yakima.net
        ServerName kozmo.yakima.net
        #       ServerName localhost
        ServerName sitedown.yakima.net
        ServerName rainloop.yakima.net
        ServerName woo.yakima.net
        #       ServerName new.yakima.net
        ServerName dev.ag-mg-timesheets.com
        ServerName ag-mg-timesheets.com
        ServerName demo.yakima.net
        ServerName dev.in-command.com
        ServerName www.yaknll.org
        ServerName prestashop.yakima.net
        ServerName squirrelmail.yakima.net
        ServerName roundcube.yakima.net
        ServerName vhost.incommand.com
        ServerName remote.incommand.com
        ServerName partsreq.incommand.com
        ServerName phpmyadmin.yakima.net
        ServerName www.yakima.net
        ServerName ssc.yakima.net
        ServerName aguasoft.yakima.net
        ServerName ncactopp.org
        ServerName piwigo.yakima.net
        ServerName kwiklok.yakima.net
        ServerName mrtg.yakima.net
        ServerName employeefax.yakima.net
        ServerName cdn.yakima.net
        ServerName alaskasmallshipcruise.yakima.net
        ServerName csi.yakima.net
        ServerName ic.yakima.net
        ServerName vgfinc.yakima.net
        ServerName yir.yakima.net
        ServerName rk.yakima.net
        ServerName mssdc.yakima.net
        ServerName underwoodfruit.com
        #       ServerName tophatlimos.yakima.net
        #       ServerName www.tophatlimos.com
        ServerName underwoodfruit.yakima.net
        ServerName wicc.yakima.net
        ServerName wdcep.yakima.net
        #       ServerName awakenpreview.yakima.net
        ServerName awakendev.yakima.net
        ServerName awakenpreview.yakima.net
        ServerName www.awaken.com
        ServerName esd112.yakima.net
        ServerName soaringeaglelodge.com
        ServerName wdc2.yakima.net
        ServerName wsi.yakima.net
        ServerName newfrackenstuff.yakima.net
        #       ServerName www.soloburn.com
        #       ServerName   ncactopp.org
        ServerName www.in-command.com
        ServerName miniaudit.incommand.com
        #       ServerName wpthemedev.yakima.net
        ServerName collab.in-command.com
        ServerName www.yakimamail.com
        ServerName mailman.yakima.net
        ServerName preview.in-command.com
        ServerName beta.in-command.com
        ServerName status.in-command.com
        ServerName www.yakamarv.com
        ServerName www.yakamamuseum.com
        ServerName www.lacasahogar.com
        ServerName www.talbottlaw.com
        ServerName www.wildwilloworchard.com
        ServerName www.taxidermyschoolsonline.com
        #        ServerName www.grayse.gs
        ServerName www.germanlonghairpointerbreeders.com
        ServerName www.feminabeauty.com
        #        ServerName www.buypearsonline.com
        ServerName www.hazardouswastetraining.org
        ServerName fitico.yakima.net
        ServerName www.fitico.com
        ServerName www.peakpassionproject.com
        ServerName www.sousley.com
        ServerName test.sousley.com
        #       ServerName www.oldheritagetaxidermy.com
        ServerName www.virtuosityproductions.com
        #       ServerName www.firmanpollen.com
        ServerName www.manorandstreet.com
        ServerName www.yakimademocrats.com
        #       ServerName www.monsonfruit.com
        #       ServerName www.knuckleheadsports.com
        ServerName spokaneoptometrists.com
        ServerName www.treeoflifeyakima.org
        ServerName gearup.rgicorporation.com
        ServerName 21stcentury.rgicorporation.com
        ServerName adwords.in-command.com
        #        ServerName ancientartsmassageschool.com
        ServerName dee-lightful.com
        #        ServerName hermistonchurches.com
        #        ServerName www.nhvwine.com
        ServerName oconnorfamilydental.com
        ServerName mssdc.com
        #        ServerName oaksapts.com
        ServerName www.twovalleys-onevision.org
        #       ServerName www.fleetisoriginals.com
        ServerName www.thethreelionspub.com
        ServerName www.ynwildlife.org
        ServerName kwiklok.com
        ServerName wenasvalleymuzzleloaders.org
        #       ServerName scenicviewdental.com
        ServerName wenasvalleymuzzleloaders.com
        ServerName www.williamsonfarmsbeef.com
        #       ServerName jewelapple.com
        ServerName srbfoundation.org
        ServerName oconnorfamilydental.com
        #        ServerName oaksapts.com
        ServerName feminabeauty.com
        ServerName mountainstarkennels.com
        ServerName hearthealing.net
        #        ServerName onsitegasgeneration.org
        #       ServerName pahtotransit.com
        ServerName yakimaadjustmentservice.com
        ServerName valicofffarms.yakima.net
        ServerName yakimaicerink.com
        #       ServerName fiberfantasies.com
        #       ServerName dltllc.net
        ServerName yakamapower.yakima.net
        ServerName ywpjobs.esd112.org
        ServerName www.yakamanation-nsn.gov
        #        ServerName www.ynoot.com
        ServerName myschoolmate.incommand.com
        ServerName www.californialegalmalpractice.net
        ServerName www.yakamanationfire.com
        ServerName www.schreinertitle.com
        #        ServerName www.vgfinc.com
        ServerName op.yakima.net
        ServerName uwgearup.org
        ServerName uwgearup.com
        ServerName wp.incommand.com
        ServerName crm.incommand.com
        ServerName suitecrm.incommand.com
        ServerName www.ysomusic.org
        #        ServerName www.yakimavalleytourism.com
        #        ServerName www.americanroofingwenatchee.com
        ServerName www.internetmarketing-inc.com
        #        ServerName www.stjoesbingo.com
        ServerName www.knuckleheadindustrial.com
        ServerName www.selahfence.com
        ServerName www.yakimafencing.com
        ServerName www.meadowlandsyakima.com
        #        ServerName  thegirlsofpinball.com
        ServerName shermandirectory.yakima.net
        #     ServerName wa4thcddemocrats.com
        #        ServerName www.eviescatering.com
        #        ServerName www.imperialcon.com
        ServerName eviescatering.yakima.net
        ServerName oldincommand.yakima.net
        #        ServerName kfio.info
        #        ServerName kspo.com
        #        ServerName ktac.com
        #        ServerName ktbi.com
        #        ServerName kyak.com
        #        ServerName kgdn.com
        #        ServerName alaskavacationadventures.com
        #        ServerName ktrw.com
        #        ServerName www.expo74.info
        #        ServerName oldtimeradio.org
        #        ServerName www.tomread.info
        #        ServerName www.apb.org
        #        ServerName www.frankierandall.com
        #        ServerName www.talkofthedesert.tv
        #        ServerName www.810club.org
        #        ServerName www.francuzzo.com
        #        ServerName www.thatsitalian.org
        #        ServerName sunvalleynews.com
        #        ServerName palmspringsnews.com
        #        ServerName tacomanarrowsbridge.info
        #        ServerName mutualnetwork.net
        #        ServerName libertybroadcastingsystem.net
        ServerName www.googleadwordsuccess.com
        ServerName www.doyleelectric.com
        #        ServerName alaskafishingcoupons.com
        #        ServerName preview.ninilchik.com
        #       ServerName www.homerhalibutcharter.com
        #        ServerName ninilchik.com
        ##        ServerName www.ynha.org
        #        ServerName www.homerhalibutcharter.com
        ServerName taggaresfruittimesheet.com
        ServerName www.yvam.net";

        $results = [
            "notfound" => [],
            "mismatch" => [],
            "subdomains" => []
        ];

        $vhostListArray = explode("\n", $vhostList);

        $vhostListArrayCount = count($vhostListArray);

        $cnt = 0;

        foreach (explode("\n", $vhostList) as $v) {
            
            $cnt ++;

            if (($v = trim($v)) == "")
                continue;

            if ($v[0] == "#")
                continue;

            list ($ignore, $serverName) = explode(" ", $v, 2);

            echo "[$cnt" . "/" . $vhostListArrayCount . "] checking $serverName: ";
            
            //$serverName = "asdfalsjdfhlasjkdhflaksjhdflasdf.cc";

            $cmd = "/usr/bin/nslookup $serverName 8.8.8.8";


            $output = [];

            $execResults = exec($cmd, $output, $resultCode);

            $output = explode("\n", trim(implode("\n", $output)));

            array_shift($output);
            array_shift($output);
            array_shift($output);
            array_shift($output);

            if (count($output) == 0) {
                $results["notfound"][] = $serverName;
                echo "NOTFOUND\n";
            } else {                
                $nameParts = explode("\t", array_shift($output), 2);

                if (trim($nameParts[1]) != $serverName) {
                    $results["mismatch"][$serverName] = $nameParts[1];

                    echo "[" . $nameParts[1] . "] MISMATCH\n";
                } else {
                    $addressParts = explode(" ", array_shift($output), 2);

                    if (!isset($results[$addressParts[1]]))
                        $results[$addressParts[1]] = [];

                    $localSites = [
                        "yakima.net",
                        "www.yakima.net",
                        "incommand.com",
                        "www.incommand.com",
                        "in-command.com",
                        "www.in-command.com"
                    ];
                    if (substr($serverName, - 11) == ".yakima.net" || substr($serverName, -14) == ".incommand.com" || substr($serverName, -15) == ".in-command.com") {
                        $results["subdomains"][$serverName] = $addressParts[1];
                        echo "[" . $addressParts[1] . "] PREVIEW OR DEV SITE\n";
                    } else {
                        $results[$addressParts[1]][] = $serverName;
                        echo "[" . $addressParts[1] . "]\n";
                    }
                }

                sleep (1);
            }
        }

        file_put_contents("scan.results", print_r($results, true));
        file_put_contents("scan.results.serialized", serialize($results));

        print_r($results);








/*

*** This is for table: 46_x000D_ (2023)
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "46_x000D_" isn't numeric in division (/) at ./processSSCxls-from-cli.pl line 134.


Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Use of uninitialized value in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "infant" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "preschooler" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "preschooler" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "preschooler" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "preschooler" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "school-age" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.
Argument "teenager" isn't numeric in sprintf at ./processSSCxls-from-cli.pl line 122.




*/
?>